var slice=[].slice,FONT='20pt \'Gloria Hallelujah\'',ShakyCanvas=function(a){this.ctx=a.getContext('2d'),this.ctx.lineWidth=3,this.ctx.font=FONT,this.ctx.textBaseline='middle'};ShakyCanvas.prototype.moveTo=function(a,b){this.x0=a,this.y0=b},ShakyCanvas.prototype.lineTo=function(a,b){return this.shakyLine(this.x0,this.y0,a,b),this.moveTo(a,b)},ShakyCanvas.prototype.shakyLine=function(a,b,e,f){var g,h,o,p,q,r,s,t,u,v,w,z;return h=e-a,o=f-b,r=Math.sqrt(h*h+o*o),g=Math.sqrt(r)/1.5,p=Math.random(),q=Math.random(),s=Math.random()*g,t=Math.random()*g,u=a+h*p+o/r*s,w=b+o*p-h/r*s,v=a+h*q-o/r*t,z=b+o*q+h/r*t,this.ctx.moveTo(a,b),this.ctx.bezierCurveTo(u,w,v,z,e,f)},ShakyCanvas.prototype.bulb=function(a,b){var e,f,g,h;for(e=function(){return 2*Math.random()-1},h=[],f=g=0;2>=g;f=++g)this.beginPath(),this.ctx.arc(a+e(),b+e(),5,0,2*Math.PI,!0),this.ctx.closePath(),h.push(this.ctx.fill());return h},ShakyCanvas.prototype.arrowhead=function(a,b,e,f){var g,h,o,p,q,r,s,t,u,v,w;return p=a-e,q=b-f,g=0===q?0>p?-Math.PI:0:Math.atan(q/p),h=g+0.5,o=g-0.5,r=20,t=e+r*Math.cos(h),v=f+r*Math.sin(h),this.beginPath(),this.moveTo(t,v),this.lineTo(e,f),this.stroke(),s=20,u=e+s*Math.cos(o),w=f+s*Math.sin(o),this.beginPath(),this.moveTo(u,w),this.lineTo(e,f),this.stroke()},ShakyCanvas.prototype.beginPath=function(){return this.ctx.beginPath()},ShakyCanvas.prototype.stroke=function(){return this.ctx.stroke()},ShakyCanvas.prototype.setStrokeStyle=function(a){return this.ctx.strokeStyle=a},ShakyCanvas.prototype.setFillStyle=function(a){return this.ctx.fillStyle=a},ShakyCanvas.prototype.fillText=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],(b=this.ctx).fillText.apply(b,a)};var CELL_SIZE=15,X=function(a){return a*CELL_SIZE+CELL_SIZE/2},Y=function(a){return a*CELL_SIZE+CELL_SIZE/2},Point=function(a,b){this.x=a,this.y=b},Line=function(a,b,e,f,g,h,o){this.x0=a,this.y0=b,this.start=e,this.x1=f,this.y1=g,this.end=h,this.color=o};Line.prototype.draw=function(a){return a.setStrokeStyle(this.color),a.setFillStyle(this.color),a.beginPath(),a.moveTo(X(this.x0),Y(this.y0)),a.lineTo(X(this.x1),Y(this.y1)),a.stroke(),this._ending(a,this.start,X(this.x1),Y(this.y1),X(this.x0),Y(this.y0)),this._ending(a,this.end,X(this.x0),Y(this.y0),X(this.x1),Y(this.y1))},Line.prototype._ending=function(a,b,e,f,g,h){return'circle'===b?a.bulb(g,h):'arrow'===b?a.arrowhead(e,f,g,h):void 0};var Text=function(a,b,e,f){this.x0=a,this.y0=b,this.text=e,this.color=f};Text.prototype.draw=function(a){return a.setFillStyle(this.color),a.fillText(this.text,X(this.x0),Y(this.y0))};var parseASCIIArt=function(a){var b,e,f,g,h,o,p,q,r,s,t,u,v,w,z,A,B,C,D,E,F,G,H;for(B=a.split('\n'),s=B.length,F=Math.max.apply(Math,function(){var I,J,L;for(L=[],I=0,J=B.length;I<J;I++)A=B[I],L.push(A.length);return L}()),e=[],b=function(I,J){var L;return null==(L=e[I])?void 0:L[J]},(H=v=0,z=B.length);v<z;H=++v)for(A=B[H],e[H]=A.split(''),(G=w=C=A.length,D=F);C<=D?w<D:w>D;G=C<=D?++w:--w)e[H][G]=' ';for(u=function(I,J){var L;return L=b(J,I),'|'===L||'-'===L||'+'===L||'~'===L||'!'===L},E=function(I,J){switch(b(J,I)){case'~':case'!':return'#666';}},t=function(I,J){var L;return L=b(J,I),'*'===L||'<'===L||'>'===L||'^'===L||'v'===L},r=function(){var I,J,L,M;for(H=I=0,L=s;0<=L?I<L:I>L;H=0<=L?++I:--I)for(G=J=0,M=F;0<=M?J<M:J>M;G=0<=M?++J:--J)if('|'===e[H][G]||'-'===e[H][G])return new Point(G,H)},f={'-':new Point(1,0),'|':new Point(0,1)},h=function(I,J,L,M){switch(b(J,I)){case'|':case'-':case'*':case'>':case'<':case'^':case'v':case'~':case'!':return e[J][I]=' ';case'+':switch(L=1-L,M=1-M,e[J][I]=' ',b(J-M,I-L)){case'|':case'!':case'+':return void(e[J][I]='|');case'-':case'~':return void(e[J][I]='-');}switch(b(J+M,I+L)){case'|':case'!':case'+':return e[J][I]='|';case'-':case'~':return e[J][I]='-';}}},g=function(I){var J,L,M,N;if(J=I.x0===I.x1?0:1,L=I.y0===I.y1?0:1,0!==J||0!==L){for(G=I.x0+J,H=I.y0+L,M=I.x1-J,N=I.y1-L;G<=M&&H<=N;)h(G,H,J,L),G+=J,H+=L;return h(I.x0,I.y0,J,L),h(I.x1,I.y1,J,L)}return h(I.x0,I.y0,J,L)},q=[],o=function(){var I,J,L,M,N,O,P,Q,R;if(I=r(),null==I)return!1;for(L=f[e[I.y][I.x]],O=I.x,Q=I.y,J=null;u(O-L.x,Q-L.y);)O-=L.x,Q-=L.y,null==J&&(J=E(O,Q));for(N=null,t(O-L.x,Q-L.y)&&(O-=L.x,Q-=L.y,N='*'===e[Q][O]?'circle':'arrow'),P=I.x,R=I.y;u(P+L.x,R+L.y);)P+=L.x,R+=L.y,null==J&&(J=E(P,R));return M=null,t(P+L.x,R+L.y)&&(P+=L.x,R+=L.y,M='*'===e[R][P]?'circle':'arrow'),A=new Line(O,Q,N,P,R,M,null==J?'black':J),q.push(A),g(A),'arrow'===N&&(A.x0-=L.x,A.y0-=L.y),'arrow'===M&&(A.x1+=L.x,A.y1+=L.y),!0},p=function(){var I,J,L,M,N,O,P,Q;for(O=[],H=L=0,N=s;0<=N?L<N:L>N;H=0<=N?++L:--L)G=0,O.push(function(){var R;for(R=[];G<F;)if(' '===e[H][G])R.push(G++);else{for(P=J=G;J<F&&' '!==e[H][J];)J++;Q=e[H].slice(P,J).join(''),M=q[q.length-1],'Text'===(null==M?void 0:M.constructor.name)&&M.x0+M.text.length+1===P?M.text=M.text+' '+Q:(I='black','\\'===Q[0]&&'\\'===Q[Q.length-1]&&(Q=Q.substring(1,Q.length-1),I='#666'),q.push(new Text(G,H,Q,I))),R.push(G=J)}return R}());return O};o(););return p(),q},doc=document,$=function(a){return doc.getElementById(a)},drawDiagram=function(){var a,b,e,f,g,h,o,p,q,r,s;for(localStorage.setItem('leftPane',textarea.value),f=parseASCIIArt($('textarea').value),s=0,g=0,(h=0,p=f.length);h<p;h++)e=f[h],'Line'===e.constructor.name&&(s=Math.max(s,X(e.x1+1)),g=Math.max(g,Y(e.y1+1)));for(a=$('canvas'),a.width=s,a.height=g,b=new ShakyCanvas(a),r=[],(o=0,q=f.length);o<q;o++)e=f[o],r.push(e.draw(b));return r},textarea=$('textarea');textarea.addEventListener('change',function(){ga('send',{hitType:'event',eventCategory:'general',eventAction:'click',eventLabel:'redraw'}),drawDiagram()}),textarea.addEventListener('keyup',function(){ga('send',{hitType:'event',eventCategory:'general',eventAction:'click',eventLabel:'redraw'}),drawDiagram()}),doc.addEventListener('DOMContentLoaded',drawDiagram,!1);var oldText=localStorage.getItem('leftPane');oldText&&(textarea.value=oldText),doc.fonts?doc.fonts.ready.then(drawDiagram):setTimeout(drawDiagram,2e3),$('download').addEventListener('click',function(){ga('send',{hitType:'event',eventCategory:'general',eventAction:'click',eventLabel:'download'});var a=$('canvas').toDataURL('image/png');$('download').href=a},!1),$('close').addEventListener('click',function(){$('overlay').style.display='none'},!1),$('about').addEventListener('click',function(){ga('send',{hitType:'event',eventCategory:'general',eventAction:'click',eventLabel:'about'}),$('overlay').style.display='block'},!1);
